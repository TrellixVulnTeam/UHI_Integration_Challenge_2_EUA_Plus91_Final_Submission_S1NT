import { __decorate } from "tslib";
import { HttpClient } from '@angular/common/http';
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, HostListener, Input, OnDestroy, OnInit, Output, TemplateRef, ViewChild, ViewContainerRef, } from '@angular/core';
import { of, Subject } from 'rxjs';
import { concat, debounceTime, distinctUntilChanged, filter, map, switchMap, tap, } from 'rxjs/operators';
import { Key } from './models';
import { createParamsForQuery, hasCharacters, isEnterKey, isEscapeKey, isIndexActive, resolveApiMethod, resolveNextIndex, toFormControlValue, toJsonpFinalResults, toJsonpSingleResult, validateArrowKeys, validateNonCharKeyCode, resolveItemValue, NO_INDEX, } from './ngx-typeahead.utils';
/*
 using an external template:
 <input [taItemTpl]="itemTpl" >

  <ng-template #itemTpl let-result>
    <strong>MY {{ result.result }}</strong>
  </ng-template>
*/
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common/http';
import * as ɵngcc2 from '@angular/common';

function NgxTypeAheadComponent_ng_template_0_section_0_button_2_span_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span");
    ɵngcc0.ɵɵelement(1, "i", 8);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const result_r4 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", result_r4, "");
} }
function NgxTypeAheadComponent_ng_template_0_section_0_button_2_ng_template_2_Template(rf, ctx) { }
const _c0 = function (a0, a1) { return { result: a0, index: a1 }; };
const _c1 = function (a0) { return { $implicit: a0 }; };
function NgxTypeAheadComponent_ng_template_0_section_0_button_2_Template(rf, ctx) { if (rf & 1) {
    const _r10 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 5);
    ɵngcc0.ɵɵlistener("click", function NgxTypeAheadComponent_ng_template_0_section_0_button_2_Template_button_click_0_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r10); const result_r4 = restoredCtx.$implicit; const i_r5 = restoredCtx.index; const ctx_r9 = ɵngcc0.ɵɵnextContext(3); return ctx_r9.handleSelectionClick(result_r4, i_r5); });
    ɵngcc0.ɵɵtemplate(1, NgxTypeAheadComponent_ng_template_0_section_0_button_2_span_1_Template, 3, 1, "span", 6);
    ɵngcc0.ɵɵtemplate(2, NgxTypeAheadComponent_ng_template_0_section_0_button_2_ng_template_2_Template, 0, 0, "ng-template", 7);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const result_r4 = ctx.$implicit;
    const i_r5 = ctx.index;
    const ctx_r3 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵclassProp("active", ctx_r3.markIsActive(i_r5, result_r4));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r3.taItemTpl);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r3.taItemTpl)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction1(8, _c1, ɵngcc0.ɵɵpureFunction2(5, _c0, result_r4, i_r5)));
} }
function NgxTypeAheadComponent_ng_template_0_section_0_Template(rf, ctx) { if (rf & 1) {
    const _r12 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "section", 2);
    ɵngcc0.ɵɵelementStart(1, "div", 3);
    ɵngcc0.ɵɵlistener("click", function NgxTypeAheadComponent_ng_template_0_section_0_Template_div_click_1_listener() { ɵngcc0.ɵɵrestoreView(_r12); const ctx_r11 = ɵngcc0.ɵɵnextContext(2); return ctx_r11.hideSuggestions(); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(2, NgxTypeAheadComponent_ng_template_0_section_0_button_2_Template, 3, 10, "button", 4);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r2.results);
} }
function NgxTypeAheadComponent_ng_template_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, NgxTypeAheadComponent_ng_template_0_section_0_Template, 3, 1, "section", 1);
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.showSuggestions);
} }
let NgxTypeAheadComponent = class NgxTypeAheadComponent {
    constructor(element, viewContainer, http, cdr) {
        this.element = element;
        this.viewContainer = viewContainer;
        this.http = http;
        this.cdr = cdr;
        this.showSuggestions = false;
        this.results = [];
        this.taUrl = '';
        this.taParams = {};
        this.taQueryParam = 'q';
        this.taApi = 'jsonp';
        this.taApiMethod = 'get';
        this.taList = [];
        this.taListItemField = [];
        this.taListItemLabel = '';
        this.taDebounce = 300;
        this.taAllowEmpty = false;
        this.taCaseSensitive = false;
        this.taDisplayOnFocus = false;
        this.taSelected = new EventEmitter();
        this.suggestionIndex = 0;
        this.subscriptions = [];
        this.activeResult = '';
        this.searchQuery = '';
        this.selectedItem = {};
        this.resultsAsItems = [];
        this.keydown$ = new Subject();
        this.keyup$ = new Subject();
    }
    handleEsc(event) {
        if (isEscapeKey(event)) {
            this.hideSuggestions();
            event.preventDefault();
        }
        this.keydown$.next(event);
    }
    onkeyup(event) {
        event.preventDefault();
        event.stopPropagation();
        this.keyup$.next(event);
    }
    onClick() {
        if (this.taDisplayOnFocus) {
            this.displaySuggestions();
        }
    }
    ngOnInit() {
        this.filterEnterEvent(this.keydown$);
        this.listenAndSuggest(this.keyup$);
        this.navigateWithArrows(this.keydown$);
        this.renderTemplate();
    }
    ngOnDestroy() {
        this.keydown$.complete();
        this.keyup$.complete();
    }
    renderTemplate() {
        if (!this.suggestionsTplRef) {
            console.error('NO NGXTA Template Found. Requires NG9');
            return;
        }
        this.viewContainer.createEmbeddedView(this.suggestionsTplRef);
        this.cdr.markForCheck();
    }
    listenAndSuggest(obs) {
        obs
            .pipe(
        // tslint:disable-next-line: deprecation
        filter((e) => validateNonCharKeyCode(e.code)), map(toFormControlValue), debounceTime(this.taDebounce), 
        // tslint:disable-next-line: deprecation
        concat(), distinctUntilChanged(), filter((query) => this.taAllowEmpty || hasCharacters(query)), tap((query) => (this.searchQuery = query)), switchMap((query) => this.suggest(query)))
            .subscribe((results) => {
            this.assignResults(results);
            // this.updateIndex(Key.ArrowDown);
            this.displaySuggestions();
        });
    }
    assignResults(results) {
        const labelForDisplay = this.taListItemLabel;
        this.resultsAsItems = results;
        this.results = results.map((item) => labelForDisplay ? item[labelForDisplay] : item);
        this.suggestionIndex = NO_INDEX;
        if (!results || !results.length) {
            this.activeResult = this.searchQuery;
        }
    }
    filterEnterEvent(elementObs) {
        elementObs.pipe(filter(isEnterKey)).subscribe((event) => {
            this.handleSelectSuggestion(this.activeResult);
        });
    }
    navigateWithArrows(elementObs) {
        elementObs
            .pipe(map((e) => e.key), filter((key) => validateArrowKeys(key)))
            .subscribe((key) => {
            this.updateIndex(key);
            this.displaySuggestions();
        });
    }
    updateIndex(keyCode) {
        this.suggestionIndex = resolveNextIndex(this.suggestionIndex, keyCode === Key.ArrowDown, this.results.length);
    }
    displaySuggestions() {
        this.showSuggestions = true;
        this.cdr.markForCheck();
    }
    suggest(query) {
        return this.taList.length
            ? this.createListSource(this.taList, query)
            : this.request(query);
    }
    /**
     * peforms a jsonp/http request to search with query and params
     * @param query the query to search from the remote source
     */
    request(query) {
        const url = this.taUrl;
        const searchConfig = createParamsForQuery(query, this.taQueryParam, this.taParams);
        const options = {
            params: searchConfig,
        };
        const isJsonpApi = this.taApi === 'jsonp';
        return isJsonpApi
            ? this.requestJsonp(url, options, this.taCallbackParamValue)
            : this.requestHttp(url, options);
    }
    requestHttp(url, options) {
        const apiMethod = resolveApiMethod(this.taApiMethod);
        return this.http[apiMethod](url, options);
    }
    requestJsonp(url, options, callback = 'callback') {
        const params = options.params.toString();
        return this.http
            .jsonp(`${url}?${params}`, callback)
            .pipe(map(toJsonpSingleResult), map(toJsonpFinalResults));
    }
    markIsActive(index, result) {
        const isActive = isIndexActive(index, this.suggestionIndex);
        if (isActive) {
            this.activeResult = result;
        }
        return isActive;
    }
    handleSelectionClick(suggestion, index) {
        this.suggestionIndex = index;
        this.handleSelectSuggestion(suggestion);
    }
    handleSelectSuggestion(suggestion) {
        const result = this.resultsAsItems.length
            ? this.resultsAsItems[this.suggestionIndex]
            : suggestion;
        this.hideSuggestions();
        const resolvedResult = this.suggestionIndex === NO_INDEX ? this.searchQuery : result;
        this.taSelected.emit(resolvedResult);
    }
    hideSuggestions() {
        this.showSuggestions = false;
    }
    hasItemTemplate() {
        return this.taItemTpl !== undefined;
    }
    createListSource(list, query) {
        const sanitizedQuery = this.taCaseSensitive ? query : query.toLowerCase();
        const fieldsToExtract = this.taListItemField;
        return of(list.filter((item) => {
            return resolveItemValue(item, fieldsToExtract, this.taCaseSensitive).includes(sanitizedQuery);
        }));
    }
};
NgxTypeAheadComponent.ɵfac = function NgxTypeAheadComponent_Factory(t) { return new (t || NgxTypeAheadComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ViewContainerRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.HttpClient), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef)); };
NgxTypeAheadComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: NgxTypeAheadComponent, selectors: [["ngx-typeahead"], ["", "ngxTypeahead", ""]], viewQuery: function NgxTypeAheadComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(TemplateRef, 7);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.suggestionsTplRef = _t.first);
    } }, hostBindings: function NgxTypeAheadComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("keydown", function NgxTypeAheadComponent_keydown_HostBindingHandler($event) { return ctx.handleEsc($event); })("keyup", function NgxTypeAheadComponent_keyup_HostBindingHandler($event) { return ctx.onkeyup($event); })("click", function NgxTypeAheadComponent_click_HostBindingHandler() { return ctx.onClick(); });
    } }, inputs: { taUrl: "taUrl", taParams: "taParams", taQueryParam: "taQueryParam", taApi: "taApi", taApiMethod: "taApiMethod", taList: "taList", taListItemField: "taListItemField", taListItemLabel: "taListItemLabel", taDebounce: "taDebounce", taAllowEmpty: "taAllowEmpty", taCaseSensitive: "taCaseSensitive", taDisplayOnFocus: "taDisplayOnFocus", taItemTpl: "taItemTpl", taCallbackParamValue: "taCallbackParamValue" }, outputs: { taSelected: "taSelected" }, decls: 2, vars: 0, consts: [["suggestionsTplRef", ""], ["class", "ta-results list-group", 4, "ngIf"], [1, "ta-results", "list-group"], [1, "ta-backdrop", 3, "click"], ["type", "button", "class", "ta-item list-group-item", 3, "active", "click", 4, "ngFor", "ngForOf"], ["type", "button", 1, "ta-item", "list-group-item", 3, "click"], [4, "ngIf"], [3, "ngTemplateOutlet", "ngTemplateOutletContext"], [1, "fa", "fa-search"]], template: function NgxTypeAheadComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, NgxTypeAheadComponent_ng_template_0_Template, 1, 1, "ng-template", null, 0, ɵngcc0.ɵɵtemplateRefExtractor);
    } }, directives: [ɵngcc2.NgIf, ɵngcc2.NgForOf, ɵngcc2.NgTemplateOutlet], styles: [".ta-results[_ngcontent-%COMP%] {\n        position: absolute;\n      }\n      .ta-backdrop[_ngcontent-%COMP%] {\n        bottom: 0;\n        left: 0;\n        position: fixed;\n        right: 0;\n        top: 0;\n        z-index: 1;\n      }\n      .ta-item[_ngcontent-%COMP%] {\n        position: relative;\n        z-index: 2;\n        display: block;\n      }"] });
NgxTypeAheadComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: ViewContainerRef },
    { type: HttpClient },
    { type: ChangeDetectorRef }
];
__decorate([
    Input()
], NgxTypeAheadComponent.prototype, "taItemTpl", void 0);
__decorate([
    Input()
], NgxTypeAheadComponent.prototype, "taUrl", void 0);
__decorate([
    Input()
], NgxTypeAheadComponent.prototype, "taParams", void 0);
__decorate([
    Input()
], NgxTypeAheadComponent.prototype, "taQueryParam", void 0);
__decorate([
    Input()
], NgxTypeAheadComponent.prototype, "taCallbackParamValue", void 0);
__decorate([
    Input()
], NgxTypeAheadComponent.prototype, "taApi", void 0);
__decorate([
    Input()
], NgxTypeAheadComponent.prototype, "taApiMethod", void 0);
__decorate([
    Input()
], NgxTypeAheadComponent.prototype, "taList", void 0);
__decorate([
    Input()
], NgxTypeAheadComponent.prototype, "taListItemField", void 0);
__decorate([
    Input()
], NgxTypeAheadComponent.prototype, "taListItemLabel", void 0);
__decorate([
    Input()
], NgxTypeAheadComponent.prototype, "taDebounce", void 0);
__decorate([
    Input()
], NgxTypeAheadComponent.prototype, "taAllowEmpty", void 0);
__decorate([
    Input()
], NgxTypeAheadComponent.prototype, "taCaseSensitive", void 0);
__decorate([
    Input()
], NgxTypeAheadComponent.prototype, "taDisplayOnFocus", void 0);
__decorate([
    Output()
], NgxTypeAheadComponent.prototype, "taSelected", void 0);
__decorate([
    ViewChild(TemplateRef, { static: true })
], NgxTypeAheadComponent.prototype, "suggestionsTplRef", void 0);
__decorate([
    HostListener('keydown', ['$event'])
], NgxTypeAheadComponent.prototype, "handleEsc", null);
__decorate([
    HostListener('keyup', ['$event'])
], NgxTypeAheadComponent.prototype, "onkeyup", null);
__decorate([
    HostListener('click')
], NgxTypeAheadComponent.prototype, "onClick", null);
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(NgxTypeAheadComponent, [{
        type: Component,
        args: [{
                // tslint:disable-next-line: component-selector
                selector: 'ngx-typeahead, [ngxTypeahead]',
                template: `
    <ng-template #suggestionsTplRef>
      <section class="ta-results list-group" *ngIf="showSuggestions">
        <div class="ta-backdrop" (click)="hideSuggestions()"></div>
        <button
          type="button"
          class="ta-item list-group-item"
          *ngFor="let result of results; let i = index"
          [class.active]="markIsActive(i, result)"
          (click)="handleSelectionClick(result, i)"
        >
          <span *ngIf="!taItemTpl"
            ><i class="fa fa-search"></i> {{ result }}</span
          >
          <ng-template
            [ngTemplateOutlet]="taItemTpl"
            [ngTemplateOutletContext]="{
              $implicit: { result: result, index: i }
            }"
          ></ng-template>
        </button>
      </section>
    </ng-template>
  `,
                styles: [`
      .ta-results {
        position: absolute;
      }
      .ta-backdrop {
        bottom: 0;
        left: 0;
        position: fixed;
        right: 0;
        top: 0;
        z-index: 1;
      }
      .ta-item {
        position: relative;
        z-index: 2;
        display: block;
      }
    `]
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.ViewContainerRef }, { type: ɵngcc1.HttpClient }, { type: ɵngcc0.ChangeDetectorRef }]; }, { taUrl: [{
            type: Input
        }], taParams: [{
            type: Input
        }], taQueryParam: [{
            type: Input
        }], taApi: [{
            type: Input
        }], taApiMethod: [{
            type: Input
        }], taList: [{
            type: Input
        }], taListItemField: [{
            type: Input
        }], taListItemLabel: [{
            type: Input
        }], taDebounce: [{
            type: Input
        }], taAllowEmpty: [{
            type: Input
        }], taCaseSensitive: [{
            type: Input
        }], taDisplayOnFocus: [{
            type: Input
        }], taSelected: [{
            type: Output
        }], handleEsc: [{
            type: HostListener,
            args: ['keydown', ['$event']]
        }], onkeyup: [{
            type: HostListener,
            args: ['keyup', ['$event']]
        }], onClick: [{
            type: HostListener,
            args: ['click']
        }], taItemTpl: [{
            type: Input
        }], taCallbackParamValue: [{
            type: Input
        }], suggestionsTplRef: [{
            type: ViewChild,
            args: [TemplateRef, { static: true }]
        }] }); })();
export { NgxTypeAheadComponent };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXR5cGVhaGVhZC5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIm5neC10eXBlYWhlYWQvbGliL25neC10eXBlYWhlYWQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUNMLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixZQUFZLEVBQ1osS0FBSyxFQUNMLFNBQVMsRUFDVCxNQUFNLEVBQ04sTUFBTSxFQUNOLFdBQVcsRUFDWCxTQUFTLEVBQ1QsZ0JBQWdCLEdBQ2pCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxFQUFFLEVBQWMsT0FBTyxFQUFnQixNQUFNLE1BQU0sQ0FBQztBQUM3RCxPQUFPLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixvQkFBb0IsRUFDcEIsTUFBTSxFQUNOLEdBQUcsRUFDSCxTQUFTLEVBQ1QsR0FBRyxHQUNKLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEIsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUMvQixPQUFPLEVBQ0wsb0JBQW9CLEVBQ3BCLGFBQWEsRUFDYixVQUFVLEVBQ1YsV0FBVyxFQUNYLGFBQWEsRUFDYixnQkFBZ0IsRUFDaEIsZ0JBQWdCLEVBQ2hCLGtCQUFrQixFQUNsQixtQkFBbUIsRUFDbkIsbUJBQW1CLEVBQ25CLGlCQUFpQixFQUNqQixzQkFBc0IsRUFDdEIsZ0JBQWdCLEVBQ2hCLFFBQVEsR0FDVCxNQUFNLHVCQUF1QixDQUFDO0FBRS9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaURGLElBQWEscUJBQXFCLEdBQWxDLE1BQWEscUJBQXFCO0FBQUcsSUFnRG5DLFlBQ1UsT0FBbUIsRUFDbkIsYUFBK0Is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QUFLLEVBQUU7QUFDViwrREFBMkI7QUFHekI7QUFBYSxJQURaLE1BQU0sRUFBRTtBQUNYLHlEQUFnRDtBQUc5QztBQUFhLElBRFosU0FBUyxDQUFDLFdBQVcsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQztBQUMzQyxnRUFBc0M7QUFtQnBDO0FBQWEsSUFEWixZQUFZLENBQUMsU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDdEMsc0RBTUc7QUFHRDtBQUFhLElBRFosWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ3BDLG9EQUlHO0FBR0Q7QUFDRCxJQUZFLFlBQVksQ0FBQyxPQUFPLENBQUM7QUFDeEIsb0RBSUc7QUE1RVUscUJBQXFCLG9CQWhEakMsU0FBUyxDQUFDLFVBQ1QsK0NBQStDO0FBQy9DLFFBQVEsRUFBRTtnQkFBK0I7U0FxQnpDLFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztzQkF1QlQsbUJBMUNDOzs7Ozs7Ozs7Ozs7Ozs7O1FBaUJDLE9BMEJKO0FBQUMsSUFDVztLQUFxQixDQXFQakM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQUNEO0FBQUMsU0F0UFkscUJBQXFCO0FBQUkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0TGlzdGVuZXIsXG4gIElucHV0LFxuICBPbkRlc3Ryb3ksXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBUZW1wbGF0ZVJlZixcbiAgVmlld0NoaWxkLFxuICBWaWV3Q29udGFpbmVyUmVmLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IG9mLCBPYnNlcnZhYmxlLCBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG4gIGNvbmNhdCxcbiAgZGVib3VuY2VUaW1lLFxuICBkaXN0aW5jdFVudGlsQ2hhbmdlZCxcbiAgZmlsdGVyLFxuICBtYXAsXG4gIHN3aXRjaE1hcCxcbiAgdGFwLFxufSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBLZXkgfSBmcm9tICcuL21vZGVscyc7XG5pbXBvcnQge1xuICBjcmVhdGVQYXJhbXNGb3JRdWVyeSxcbiAgaGFzQ2hhcmFjdGVycyxcbiAgaXNFbnRlcktleSxcbiAgaXNFc2NhcGVLZXksXG4gIGlzSW5kZXhBY3RpdmUsXG4gIHJlc29sdmVBcGlNZXRob2QsXG4gIHJlc29sdmVOZXh0SW5kZXgsXG4gIHRvRm9ybUNvbnRyb2xWYWx1ZSxcbiAgdG9Kc29ucEZpbmFsUmVzdWx0cyxcbiAgdG9Kc29ucFNpbmdsZVJlc3VsdCxcbiAgdmFsaWRhdGVBcnJvd0tleXMsXG4gIHZhbGlkYXRlTm9uQ2hhcktleUNvZGUsXG4gIHJlc29sdmVJdGVtVmFsdWUsXG4gIE5PX0lOREVYLFxufSBmcm9tICcuL25neC10eXBlYWhlYWQudXRpbHMnO1xuXG4vKlxuIHVzaW5nIGFuIGV4dGVybmFsIHRlbXBsYXRlOlxuIDxpbnB1dCBbdGFJdGVtVHBsXT1cIml0ZW1UcGxcIiA+XG5cbiAgPG5nLXRlbXBsYXRlICNpdGVtVHBsIGxldC1yZXN1bHQ+XG4gICAgPHN0cm9uZz5NWSB7eyByZXN1bHQucmVzdWx0IH19PC9zdHJvbmc+XG4gIDwvbmctdGVtcGxhdGU+XG4qL1xuQENvbXBvbmVudCh7XG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogY29tcG9uZW50LXNlbGVjdG9yXG4gIHNlbGVjdG9yOiAnbmd4LXR5cGVhaGVhZCwgW25neFR5cGVhaGVhZF0nLFxuICBzdHlsZXM6IFtcbiAgICBgXG4gICAgICAudGEtcmVzdWx0cyB7XG4gICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgIH1cbiAgICAgIC50YS1iYWNrZHJvcCB7XG4gICAgICAgIGJvdHRvbTogMDtcbiAgICAgICAgbGVmdDogMDtcbiAgICAgICAgcG9zaXRpb246IGZpeGVkO1xuICAgICAgICByaWdodDogMDtcbiAgICAgICAgdG9wOiAwO1xuICAgICAgICB6LWluZGV4OiAxO1xuICAgICAgfVxuICAgICAgLnRhLWl0ZW0ge1xuICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICAgIHotaW5kZXg6IDI7XG4gICAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgICAgfVxuICAgIGAsXG4gIF0sXG4gIHRlbXBsYXRlOiBgXG4gICAgPG5nLXRlbXBsYXRlICNzdWdnZXN0aW9uc1RwbFJlZj5cbiAgICAgIDxzZWN0aW9uIGNsYXNzPVwidGEtcmVzdWx0cyBsaXN0LWdyb3VwXCIgKm5nSWY9XCJzaG93U3VnZ2VzdGlvbnNcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInRhLWJhY2tkcm9wXCIgKGNsaWNrKT1cImhpZGVTdWdnZXN0aW9ucygpXCI+PC9kaXY+XG4gICAgICAgIDxidXR0b25cbiAgICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgICBjbGFzcz1cInRhLWl0ZW0gbGlzdC1ncm91cC1pdGVtXCJcbiAgICAgICAgICAqbmdGb3I9XCJsZXQgcmVzdWx0IG9mIHJlc3VsdHM7IGxldCBpID0gaW5kZXhcIlxuICAgICAgICAgIFtjbGFzcy5hY3RpdmVdPVwibWFya0lzQWN0aXZlKGksIHJlc3VsdClcIlxuICAgICAgICAgIChjbGljayk9XCJoYW5kbGVTZWxlY3Rpb25DbGljayhyZXN1bHQsIGkpXCJcbiAgICAgICAgPlxuICAgICAgICAgIDxzcGFuICpuZ0lmPVwiIXRhSXRlbVRwbFwiXG4gICAgICAgICAgICA+PGkgY2xhc3M9XCJmYSBmYS1zZWFyY2hcIj48L2k+IHt7IHJlc3VsdCB9fTwvc3BhblxuICAgICAgICAgID5cbiAgICAgICAgICA8bmctdGVtcGxhdGVcbiAgICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0XT1cInRhSXRlbVRwbFwiXG4gICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwie1xuICAgICAgICAgICAgICAkaW1wbGljaXQ6IHsgcmVzdWx0OiByZXN1bHQsIGluZGV4OiBpIH1cbiAgICAgICAgICAgIH1cIlxuICAgICAgICAgID48L25nLXRlbXBsYXRlPlxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgIDwvc2VjdGlvbj5cbiAgICA8L25nLXRlbXBsYXRlPlxuICBgLFxufSlcbmV4cG9ydCBjbGFzcyBOZ3hUeXBlQWhlYWRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIHNob3dTdWdnZXN0aW9ucyA9IGZhbHNlO1xuICByZXN1bHRzOiBzdHJpbmdbXSA9IFtdO1xuXG4gIEBJbnB1dCgpXG4gIHRhSXRlbVRwbCE6IFRlbXBsYXRlUmVmPGFueT47XG4gIEBJbnB1dCgpXG4gIHRhVXJsID0gJyc7XG4gIEBJbnB1dCgpXG4gIHRhUGFyYW1zID0ge307XG4gIEBJbnB1dCgpXG4gIHRhUXVlcnlQYXJhbSA9ICdxJztcbiAgQElucHV0KClcbiAgdGFDYWxsYmFja1BhcmFtVmFsdWU7XG4gIEBJbnB1dCgpXG4gIHRhQXBpID0gJ2pzb25wJztcbiAgQElucHV0KClcbiAgdGFBcGlNZXRob2QgPSAnZ2V0JztcbiAgQElucHV0KClcbiAgdGFMaXN0ID0gW107XG4gIEBJbnB1dCgpXG4gIHRhTGlzdEl0ZW1GaWVsZCA9IFtdO1xuICBASW5wdXQoKVxuICB0YUxpc3RJdGVtTGFiZWwgPSAnJztcbiAgQElucHV0KClcbiAgdGFEZWJvdW5jZSA9IDMwMDtcbiAgQElucHV0KClcbiAgdGFBbGxvd0VtcHR5ID0gZmFsc2U7XG4gIEBJbnB1dCgpXG4gIHRhQ2FzZVNlbnNpdGl2ZSA9IGZhbHNlO1xuICBASW5wdXQoKVxuICB0YURpc3BsYXlPbkZvY3VzID0gZmFsc2U7XG5cbiAgQE91dHB1dCgpXG4gIHRhU2VsZWN0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZyB8IGFueT4oKTtcblxuICBAVmlld0NoaWxkKFRlbXBsYXRlUmVmLCB7IHN0YXRpYzogdHJ1ZSB9KVxuICBzdWdnZXN0aW9uc1RwbFJlZjogVGVtcGxhdGVSZWY8YW55PjtcblxuICBwcml2YXRlIHN1Z2dlc3Rpb25JbmRleCA9IDA7XG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uczogU3Vic2NyaXB0aW9uW10gPSBbXTtcbiAgcHJpdmF0ZSBhY3RpdmVSZXN1bHQgPSAnJztcbiAgcHJpdmF0ZSBzZWFyY2hRdWVyeSA9ICcnO1xuICBwcml2YXRlIHNlbGVjdGVkSXRlbTogYW55ID0ge307XG4gIHByaXZhdGUgcmVzdWx0c0FzSXRlbXM6IGFueVtdID0gW107XG4gIHByaXZhdGUga2V5ZG93biQgPSBuZXcgU3ViamVjdDxLZXlib2FyZEV2ZW50PigpO1xuICBwcml2YXRlIGtleXVwJCA9IG5ldyBTdWJqZWN0PEtleWJvYXJkRXZlbnQ+KCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBlbGVtZW50OiBFbGVtZW50UmVmLFxuICAgIHByaXZhdGUgdmlld0NvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZixcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXG4gICAgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmXG4gICkge31cblxuICBASG9zdExpc3RlbmVyKCdrZXlkb3duJywgWyckZXZlbnQnXSlcbiAgaGFuZGxlRXNjKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgaWYgKGlzRXNjYXBlS2V5KGV2ZW50KSkge1xuICAgICAgdGhpcy5oaWRlU3VnZ2VzdGlvbnMoKTtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICAgIHRoaXMua2V5ZG93biQubmV4dChldmVudCk7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdrZXl1cCcsIFsnJGV2ZW50J10pXG4gIG9ua2V5dXAoZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIHRoaXMua2V5dXAkLm5leHQoZXZlbnQpO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignY2xpY2snKVxuICBvbkNsaWNrKCkge1xuICAgIGlmICh0aGlzLnRhRGlzcGxheU9uRm9jdXMpIHtcbiAgICAgIHRoaXMuZGlzcGxheVN1Z2dlc3Rpb25zKCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5maWx0ZXJFbnRlckV2ZW50KHRoaXMua2V5ZG93biQpO1xuICAgIHRoaXMubGlzdGVuQW5kU3VnZ2VzdCh0aGlzLmtleXVwJCk7XG4gICAgdGhpcy5uYXZpZ2F0ZVdpdGhBcnJvd3ModGhpcy5rZXlkb3duJCk7XG4gICAgdGhpcy5yZW5kZXJUZW1wbGF0ZSgpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5rZXlkb3duJC5jb21wbGV0ZSgpO1xuICAgIHRoaXMua2V5dXAkLmNvbXBsZXRlKCk7XG4gIH1cblxuICByZW5kZXJUZW1wbGF0ZSgpIHtcbiAgICBpZiAoIXRoaXMuc3VnZ2VzdGlvbnNUcGxSZWYpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ05PIE5HWFRBIFRlbXBsYXRlIEZvdW5kLiBSZXF1aXJlcyBORzknKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy52aWV3Q29udGFpbmVyLmNyZWF0ZUVtYmVkZGVkVmlldyh0aGlzLnN1Z2dlc3Rpb25zVHBsUmVmKTtcbiAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuXG4gIGxpc3RlbkFuZFN1Z2dlc3Qob2JzOiBTdWJqZWN0PEtleWJvYXJkRXZlbnQ+KSB7XG4gICAgb2JzXG4gICAgICAucGlwZShcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBkZXByZWNhdGlvblxuICAgICAgICBmaWx0ZXIoKGU6IEtleWJvYXJkRXZlbnQpID0+IHZhbGlkYXRlTm9uQ2hhcktleUNvZGUoZS5jb2RlKSksXG4gICAgICAgIG1hcCh0b0Zvcm1Db250cm9sVmFsdWUpLFxuICAgICAgICBkZWJvdW5jZVRpbWUodGhpcy50YURlYm91bmNlKSxcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBkZXByZWNhdGlvblxuICAgICAgICBjb25jYXQoKSxcbiAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKSxcbiAgICAgICAgZmlsdGVyKChxdWVyeTogc3RyaW5nKSA9PiB0aGlzLnRhQWxsb3dFbXB0eSB8fCBoYXNDaGFyYWN0ZXJzKHF1ZXJ5KSksXG4gICAgICAgIHRhcCgocXVlcnk6IHN0cmluZykgPT4gKHRoaXMuc2VhcmNoUXVlcnkgPSBxdWVyeSkpLFxuICAgICAgICBzd2l0Y2hNYXAoKHF1ZXJ5OiBzdHJpbmcpID0+IHRoaXMuc3VnZ2VzdChxdWVyeSkpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKChyZXN1bHRzOiBzdHJpbmdbXSB8IGFueSkgPT4ge1xuICAgICAgICB0aGlzLmFzc2lnblJlc3VsdHMocmVzdWx0cyk7XG4gICAgICAgIC8vIHRoaXMudXBkYXRlSW5kZXgoS2V5LkFycm93RG93bik7XG4gICAgICAgIHRoaXMuZGlzcGxheVN1Z2dlc3Rpb25zKCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIGFzc2lnblJlc3VsdHMocmVzdWx0czogYW55W10pIHtcbiAgICBjb25zdCBsYWJlbEZvckRpc3BsYXkgPSB0aGlzLnRhTGlzdEl0ZW1MYWJlbDtcbiAgICB0aGlzLnJlc3VsdHNBc0l0ZW1zID0gcmVzdWx0cztcbiAgICB0aGlzLnJlc3VsdHMgPSByZXN1bHRzLm1hcCgoaXRlbTogc3RyaW5nIHwgYW55KSA9PlxuICAgICAgbGFiZWxGb3JEaXNwbGF5ID8gaXRlbVtsYWJlbEZvckRpc3BsYXldIDogaXRlbVxuICAgICk7XG4gICAgdGhpcy5zdWdnZXN0aW9uSW5kZXggPSBOT19JTkRFWDtcbiAgICBpZiAoIXJlc3VsdHMgfHwgIXJlc3VsdHMubGVuZ3RoKSB7XG4gICAgICB0aGlzLmFjdGl2ZVJlc3VsdCA9IHRoaXMuc2VhcmNoUXVlcnk7XG4gICAgfVxuICB9XG5cbiAgZmlsdGVyRW50ZXJFdmVudChlbGVtZW50T2JzOiBTdWJqZWN0PEtleWJvYXJkRXZlbnQ+KSB7XG4gICAgZWxlbWVudE9icy5waXBlKGZpbHRlcihpc0VudGVyS2V5KSkuc3Vic2NyaWJlKChldmVudDogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgdGhpcy5oYW5kbGVTZWxlY3RTdWdnZXN0aW9uKHRoaXMuYWN0aXZlUmVzdWx0KTtcbiAgICB9KTtcbiAgfVxuXG4gIG5hdmlnYXRlV2l0aEFycm93cyhlbGVtZW50T2JzOiBTdWJqZWN0PEtleWJvYXJkRXZlbnQ+KSB7XG4gICAgZWxlbWVudE9ic1xuICAgICAgLnBpcGUoXG4gICAgICAgIG1hcCgoZTogYW55KSA9PiBlLmtleSksXG4gICAgICAgIGZpbHRlcigoa2V5OiBLZXkpID0+IHZhbGlkYXRlQXJyb3dLZXlzKGtleSkpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKChrZXk6IEtleSkgPT4ge1xuICAgICAgICB0aGlzLnVwZGF0ZUluZGV4KGtleSk7XG4gICAgICAgIHRoaXMuZGlzcGxheVN1Z2dlc3Rpb25zKCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHVwZGF0ZUluZGV4KGtleUNvZGU6IHN0cmluZykge1xuICAgIHRoaXMuc3VnZ2VzdGlvbkluZGV4ID0gcmVzb2x2ZU5leHRJbmRleChcbiAgICAgIHRoaXMuc3VnZ2VzdGlvbkluZGV4LFxuICAgICAga2V5Q29kZSA9PT0gS2V5LkFycm93RG93bixcbiAgICAgIHRoaXMucmVzdWx0cy5sZW5ndGhcbiAgICApO1xuICB9XG5cbiAgZGlzcGxheVN1Z2dlc3Rpb25zKCkge1xuICAgIHRoaXMuc2hvd1N1Z2dlc3Rpb25zID0gdHJ1ZTtcbiAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuXG4gIHN1Z2dlc3QocXVlcnk6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnRhTGlzdC5sZW5ndGhcbiAgICAgID8gdGhpcy5jcmVhdGVMaXN0U291cmNlKHRoaXMudGFMaXN0LCBxdWVyeSlcbiAgICAgIDogdGhpcy5yZXF1ZXN0KHF1ZXJ5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBwZWZvcm1zIGEganNvbnAvaHR0cCByZXF1ZXN0IHRvIHNlYXJjaCB3aXRoIHF1ZXJ5IGFuZCBwYXJhbXNcbiAgICogQHBhcmFtIHF1ZXJ5IHRoZSBxdWVyeSB0byBzZWFyY2ggZnJvbSB0aGUgcmVtb3RlIHNvdXJjZVxuICAgKi9cbiAgcmVxdWVzdChxdWVyeTogc3RyaW5nKSB7XG4gICAgY29uc3QgdXJsID0gdGhpcy50YVVybDtcbiAgICBjb25zdCBzZWFyY2hDb25maWcgPSBjcmVhdGVQYXJhbXNGb3JRdWVyeShcbiAgICAgIHF1ZXJ5LFxuICAgICAgdGhpcy50YVF1ZXJ5UGFyYW0sXG4gICAgICB0aGlzLnRhUGFyYW1zXG4gICAgKTtcbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgcGFyYW1zOiBzZWFyY2hDb25maWcsXG4gICAgfTtcbiAgICBjb25zdCBpc0pzb25wQXBpID0gdGhpcy50YUFwaSA9PT0gJ2pzb25wJztcbiAgICByZXR1cm4gaXNKc29ucEFwaVxuICAgICAgPyB0aGlzLnJlcXVlc3RKc29ucCh1cmwsIG9wdGlvbnMsIHRoaXMudGFDYWxsYmFja1BhcmFtVmFsdWUpXG4gICAgICA6IHRoaXMucmVxdWVzdEh0dHAodXJsLCBvcHRpb25zKTtcbiAgfVxuXG4gIHJlcXVlc3RIdHRwKHVybDogc3RyaW5nLCBvcHRpb25zKSB7XG4gICAgY29uc3QgYXBpTWV0aG9kID0gcmVzb2x2ZUFwaU1ldGhvZCh0aGlzLnRhQXBpTWV0aG9kKTtcbiAgICByZXR1cm4gdGhpcy5odHRwW2FwaU1ldGhvZF0odXJsLCBvcHRpb25zKTtcbiAgfVxuXG4gIHJlcXVlc3RKc29ucCh1cmwsIG9wdGlvbnMsIGNhbGxiYWNrID0gJ2NhbGxiYWNrJykge1xuICAgIGNvbnN0IHBhcmFtcyA9IG9wdGlvbnMucGFyYW1zLnRvU3RyaW5nKCk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cFxuICAgICAgLmpzb25wKGAke3VybH0/JHtwYXJhbXN9YCwgY2FsbGJhY2spXG4gICAgICAucGlwZShtYXAodG9Kc29ucFNpbmdsZVJlc3VsdCksIG1hcCh0b0pzb25wRmluYWxSZXN1bHRzKSk7XG4gIH1cblxuICBtYXJrSXNBY3RpdmUoaW5kZXg6IG51bWJlciwgcmVzdWx0OiBzdHJpbmcpIHtcbiAgICBjb25zdCBpc0FjdGl2ZSA9IGlzSW5kZXhBY3RpdmUoaW5kZXgsIHRoaXMuc3VnZ2VzdGlvbkluZGV4KTtcbiAgICBpZiAoaXNBY3RpdmUpIHtcbiAgICAgIHRoaXMuYWN0aXZlUmVzdWx0ID0gcmVzdWx0O1xuICAgIH1cbiAgICByZXR1cm4gaXNBY3RpdmU7XG4gIH1cblxuICBoYW5kbGVTZWxlY3Rpb25DbGljayhzdWdnZXN0aW9uOiBzdHJpbmcsIGluZGV4OiBudW1iZXIpIHtcbiAgICB0aGlzLnN1Z2dlc3Rpb25JbmRleCA9IGluZGV4O1xuICAgIHRoaXMuaGFuZGxlU2VsZWN0U3VnZ2VzdGlvbihzdWdnZXN0aW9uKTtcbiAgfVxuXG4gIGhhbmRsZVNlbGVjdFN1Z2dlc3Rpb24oc3VnZ2VzdGlvbjogc3RyaW5nKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHRzQXNJdGVtcy5sZW5ndGhcbiAgICAgID8gdGhpcy5yZXN1bHRzQXNJdGVtc1t0aGlzLnN1Z2dlc3Rpb25JbmRleF1cbiAgICAgIDogc3VnZ2VzdGlvbjtcbiAgICB0aGlzLmhpZGVTdWdnZXN0aW9ucygpO1xuICAgIGNvbnN0IHJlc29sdmVkUmVzdWx0ID1cbiAgICAgIHRoaXMuc3VnZ2VzdGlvbkluZGV4ID09PSBOT19JTkRFWCA/IHRoaXMuc2VhcmNoUXVlcnkgOiByZXN1bHQ7XG4gICAgdGhpcy50YVNlbGVjdGVkLmVtaXQocmVzb2x2ZWRSZXN1bHQpO1xuICB9XG5cbiAgaGlkZVN1Z2dlc3Rpb25zKCkge1xuICAgIHRoaXMuc2hvd1N1Z2dlc3Rpb25zID0gZmFsc2U7XG4gIH1cblxuICBoYXNJdGVtVGVtcGxhdGUoKSB7XG4gICAgcmV0dXJuIHRoaXMudGFJdGVtVHBsICE9PSB1bmRlZmluZWQ7XG4gIH1cblxuICBjcmVhdGVMaXN0U291cmNlKGxpc3Q6IGFueVtdLCBxdWVyeTogc3RyaW5nKTogT2JzZXJ2YWJsZTxzdHJpbmdbXT4ge1xuICAgIGNvbnN0IHNhbml0aXplZFF1ZXJ5ID0gdGhpcy50YUNhc2VTZW5zaXRpdmUgPyBxdWVyeSA6IHF1ZXJ5LnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgZmllbGRzVG9FeHRyYWN0ID0gdGhpcy50YUxpc3RJdGVtRmllbGQ7XG4gICAgcmV0dXJuIG9mKFxuICAgICAgbGlzdC5maWx0ZXIoKGl0ZW06IHN0cmluZyB8IGFueSkgPT4ge1xuICAgICAgICByZXR1cm4gcmVzb2x2ZUl0ZW1WYWx1ZShcbiAgICAgICAgICBpdGVtLFxuICAgICAgICAgIGZpZWxkc1RvRXh0cmFjdCxcbiAgICAgICAgICB0aGlzLnRhQ2FzZVNlbnNpdGl2ZVxuICAgICAgICApLmluY2x1ZGVzKHNhbml0aXplZFF1ZXJ5KTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxufVxuIl19